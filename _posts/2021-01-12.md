---
layout: post
title: TV
category: dev
lang: jp
emoji: "🎍"
---

日本に帰ってきてからしばらく経ちました。在米中はTVを見ることがほとんどなく必要だと感じたことがなかったのですが、帰ってきてみると案外気になるものがでてきたりしています。しかし基本的に何事も一箇所で済ませたいタイプの人間なので、Linuxで観られるようにセットアップしてみました。


まず第一に、PC上でTVを見るにはチューナが必要です。[このブログ][article]を参考に、[PX-S1UD V2.0]というものを買ってみました。加えて、地デジを見るにはB-CASカードなるものでコピーガード？を解除しないといけないらしく、それ用のカードリーダーが必要なようです(チューナーだけで試してみたがワンセグしか観れませんでした)。またしても先程の記事を参考にして[SCR3310/v2.0]を入手しました。

これでハードは揃ったので、次に必要なソフトウェアをインストールしていきます。

実行環境はelementary OS 5.1.7 Hera(Ubuntu 18.04.4 LTS)です。

まずはPX-S1UDの公式ドライバをダウンロード・インストールします：
```shell
wget http://plex-net.co.jp/plex/px-s1ud/PX-S1UD_driver_Ver.1.0.1.zip
unzip PX-S1UD_driver_Ver.1.0.1.zip
sudo cp PX-S1UD_driver_Ver.1.0.1/x64/amd64/isdbt_rio.inp /lib/firmware/
```

続いてカードリーダー用のパッケージをインストールします：
```shell
apt update && apt install pcscd libpcsclite-dev libccid pcsc-tools
```

`pcsc_scan`というコマンドで、B-CASカードが認識されているかどうかを確認します。`Japanese Chijou Digital B-CAS Card`と出力の最後に表示されれば正常に読み込まれています。

次に、arib25というスクランブル解除用のコードをインストールします：
```shell
apt install pkg-config
wget http://hg.honeyplanet.jp/pt1/archive/c44e16dbb0e2.zip
unzip c44e16dbb0e2.zip
cd pt1-c44e16dbb0e2/arib25
make
make install
```

録画、ストリームに必要な`recdvb`をインストールします。

まずは必要なパッケージをインストールし、コードをダウンロード・解凍します：
```shell
apt install autoconf
wget http://www13.plala.or.jp/sat/recdvb/recdvb-1.2.0.tgz
tar xvzf recdvb-1.2.0.tgz
```

続いて、`recdvb`をコンパイル、インストールします：
```shell
cd recdvb-1.2.0
./autogen.sh
./configure --enable -b25
make
make install
```
`configure`実行時に`--enable -b25`を使用することで`-b25`オプションが使用可能になるらしいです。  
`ls /usr/local/bin`の実行結果が`recdvb`, `recdvbctl`, `recdvbchksig`であれば正常にインストールされたと思って良いと思います。

これでセットアップは完了です。recdvbを起動してみましょう。
```shell
recdvb --b25 --http 8080
```
を実行します。
```
using B25...
creating a http daemon
run as a daemon..
pid = 12115
listening at port 8080
```
似たような出力がされれば良いです。

以上で視聴準備は整ったので、VLCを使ってhttp:8080からストリーミングしてみます:
```shell
vlc http://localhost:8080/16 2>/dev/null
```
ポート番号後の数字でチャンネル番号を指定できます。今回は16chにしました。  
エラーメッセージが大量に吐かれるので末尾に`2>/dev/null`をつけて無視しています。

![](/assets/images/vlcsnap-2021-01-12-17h21m19s816.png)
無事映りました！


[chinachu]、[mirakurun]を使って録画サーバの構築や番組表の取得など、さらに色々なことができるようです。いつか挑戦してみたいものですが、今はリアルタイム視聴のみで満足です。気になる方は是非下記リンクを参考にしてみてください。
- https://ywnb.net/p/201612/3267
- https://ywnb.net/p/201612/3269

起動・チャンネル選択に少し手間がかかるので、簡単なbashスクリプトでチャンネル指定などをできるようにしておくと便利かもしれないです。

[B-CAS]: https://ja.wikipedia.org/wiki/B-CAS
[SCR3310/v2.0]: https://www.amazon.co.jp/gp/product/B0085H4YZC/ref=ppx_yo_dt_b_asin_title_o05_s00?ie=UTF8&psc=1
[PX-S1UD V2.0]: https://www.amazon.co.jp/gp/product/B0141NFWSG/ref=ppx_yo_dt_b_asin_title_o06_s00?ie=UTF8&psc=1
[article]: https://ywnb.net/p/201612/3262
[chinachu]: https://github.com/Chinachu/Chinachu
[mirakurun]: https://github.com/Chinachu/Mirakurun
